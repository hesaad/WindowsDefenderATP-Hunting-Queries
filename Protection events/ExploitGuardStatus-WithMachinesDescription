// Get stats on ExploitGuard events (audit, blocks, or both) - count events and machines per rule, just a small update to TomerAlpert's query (Sumamrize section)
MiscEvents 
| where ActionType in ("ExploitGuardHips", "ProcessBlockGeneratingDynamicCode", "ProcessBlockCreatingChildProcess", 
"LoadLowILImage", "LoadBinaryFromRemoteShare", "CallWin32k", "LoadNonMicrosoftSignedBinary", "ExportAddressFilter",  
"ImportAddressFilter", "Rop", "ExploitGuardHips", "NetworkFilterLookup") 
| extend IsAudit=toboolean(parse_json(AdditionalFields).IsAudit), RuleId=tostring(parse_json(AdditionalFields).RuleId) 
| where IsAudit == true 
| summarize EventTime =max(EventTime) by ComputerName, ActionType,RuleId,FileName, FolderPath, InitiatingProcessCommandLine, InitiatingProcessFileName, InitiatingProcessFolderPath, InitiatingProcessId, MD5 
  
// TODO arround mid-June 2018 the above query will start returning no results, and should be replaced with this query 
MiscEvents 
| where ActionType startswith "ExploitGuard" and ActionType endswith "Audited" 
| extend RuleId=tostring(parse_json(AdditionalFields).RuleId) 
| summarize EventCount=count(), MachinesCount=dcount(ComputerName) by ActionType, RuleId 
| where isempty(RuleId)
| where MachinesCount in (11, 7)
